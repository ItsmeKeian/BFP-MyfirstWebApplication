<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>BFP SYSTEM</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="assets/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="assets/vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <!-- End Plugin css for this page -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- End layout styles -->
    <link rel="shortcut icon" href="assets/images/favicon.png" />
  </head>
  <body>
    <div class="container-scroller">
      <!-- partial:partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <div class="sidebar-brand-wrapper d-none d-lg-flex align-items-center justify-content-center fixed-top">
          <a href="dashboard.html"><img style="width:80px; height: 75px; margin-left: -55px; border-radius: 27px; margin-top: 10px;"  src="logo.jpg" alt="BFP" /></a>
          
        </div>
        <ul class="nav">
          <li class="nav-item profile">
            <div class="profile-desc">
              <div class="profile-pic">
                <div class="count-indicator">
                  <img class="img-xs rounded-circle " src="123.png" alt="">
                  <span class="count bg-success"></span>
                </div>
                <div class="profile-name">
                   <h5 class="mb-0 font-weight-normal">Administrator</h5>
                  
                </div>
              </div>
             
             
            </div>
          </li>
          <li class="nav-item nav-category">
            <span class="nav-link">Navigation</span>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="dashboard.html">
              <span class="menu-icon">
                <i class="mdi mdi-speedometer"></i>
              </span>
              <span class="menu-title">Dashboard</span>
            </a>
          </li>
          <li class="nav-item menu-items"  >
            <a class="nav-link" data-toggle="collapse" href="#forms" aria-expanded="false" aria-controls="forms">
              <span class="menu-icon">
                <i class="mdi mdi-laptop"></i>
              </span>
              <span class="menu-title">Forms</span>
              <i class="menu-arrow"></i>
            </a>
           <div class="collapse" id="forms" > 

              <ul class="nav flex-column sub-menu">
                <li class="nav-item"> <a class="nav-link" href="buildingpermit.html">Evaluation Clearance</a></li>
                <li class="nav-item"> <a class="nav-link" href="establishment.html">Inspection Certificate</a></li>
                 <li class="nav-item"> <a class="nav-link" href="electricalclearance.html">Electrical Clearance</a></li>   
                <li class="nav-item"> <a class="nav-link" href="occupancyform.html">Occupancy Clearance</a></li>
                <li class="nav-item"> <a class="nav-link" href="formmap.html"> Mapping and Tagging</a></li>    
                <li class="nav-item"> <a class="nav-link" href="importexcelfile.html">Import Excel File</a></li>
              </ul>
            </div>
          </li>

          <li class="nav-item menu-items">
            <a class="nav-link" data-toggle="collapse" href="#files" aria-expanded="false" aria-controls="files">
              <span class="menu-icon">
                <i class="mdi mdi-chart-bar"></i>
              </span>
              <span class="menu-title">Records</span>
              <i class="menu-arrow"></i>
            </a>
            <div class="collapse" id="files">
              <ul class="nav flex-column sub-menu">
                 <li class="nav-item"> <a class="nav-link" href="buildingpermitprofile.html">Evaluation Clearance</a></li>
                <li class="nav-item"> <a class="nav-link" href="establishmentprofile.html">Inspection Certificate</a></li>
                 <li class="nav-item"> <a class="nav-link" href="electricalprofile.html">Electrical Clearance</a></li>                
                <li class="nav-item"> <a class="nav-link" href="occupancyprofile.html"> Occupancy Clearance</a></li>
               
              </ul>
            </div>
          </li>


          <li class="nav-item menu-items">
            <a class="nav-link" data-toggle="collapse" href="#analytics" aria-expanded="false" aria-controls="analytics">
              <span class="menu-icon">
                <i class="mdi mdi-table-large"></i>
              </span>
              <span class="menu-title">Data Analytics</span>
              <i class="menu-arrow"></i>
            </a>
            <div class="collapse" id="analytics">
              <ul class="nav flex-column sub-menu">
                <li class="nav-item"> <a class="nav-link" href="maps.html">Map</a></li>
                <li class="nav-item"> <a class="nav-link" href="charts.html">Charts</a></li>
               
               
              </ul>
            </div>
          </li>


          <li class="nav-item menu-items">
            <a class="nav-link" data-toggle="collapse" href="#archive" aria-expanded="false" aria-controls="archive">
              <span class="menu-icon">
                 <i class="mdi mdi-file-document-box"></i>
              </span>
              <span class="menu-title">Reports</span>
              <i class="menu-arrow"></i>
            </a>
            <div class="collapse" id="archive">
              <ul class="nav flex-column sub-menu">
                <li class="nav-item"> <a class="nav-link" href="listofbuildingpermits.html">Evaluation Clearance</a></li>
                <li class="nav-item"> <a class="nav-link" href="listofestablishments.html">Inspection Certificate</a></li>
                 <li class="nav-item"> <a class="nav-link" href="listofclearance.html">Electrical Clearance</a></li>              
                <li class="nav-item"> <a class="nav-link" href="listofoccupancy.html">Occupancy Clearance</a></li>
                
               
               
              </ul>
            </div>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" data-toggle="collapse" href="#auth" aria-expanded="false" aria-controls="auth">
              <span class="menu-icon">
                <i class="mdi mdi-security"></i>
              </span>
              <span class="menu-title">Archives</span>
              <i class="menu-arrow"></i>
            </a>
            <div class="collapse" id="auth">
              <ul class="nav flex-column sub-menu">
               <li class="nav-item"> <a class="nav-link" href="arcevaluationclearance.html"> Evaluation Clearance </a></li>
                <li class="nav-item"> <a class="nav-link" href="arcinspectioncertificate.html"> Inspection Certificate </a></li>
                <li class="nav-item"> <a class="nav-link" href="arcelectricalclearances.html"> Electrical Clearance </a></li>         
                <li class="nav-item"> <a class="nav-link" href="arcoccupancyclearance.html"> Occupancy Clearance </a></li>
                
              </ul>
            </div>
          </li>

         


        
          

          <li class="nav-item menu-items">
            <a class="nav-link" href="index.html">
              <span class="menu-icon">
                <i class="mdi mdi-playlist-play"></i>
              </span>
              <span class="menu-title">Logout</span>
            </a>
          </li>
           
          
          
         
        </ul>
      </nav>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_navbar.html -->
        <nav class="navbar p-0 fixed-top d-flex flex-row">
         
          <div class="navbar-menu-wrapper flex-grow d-flex align-items-stretch">
            <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
              <span class="mdi mdi-menu"></span>
            </button>
            <ul class="navbar-nav w-100">
             
            </ul>
            <ul class="navbar-nav navbar-nav-right">
             
              
              
             
              <li class="nav-item dropdown">
                <a class="nav-link" id="profileDropdown" href="#" data-toggle="dropdown">
                  <div class="navbar-profile">
                    <img class="img-xs rounded-circle" src="123.png" alt="">
                    <p class="mb-0 d-none d-sm-block navbar-profile-name" id="name1">admin</p>
                    <i class="mdi mdi-menu-down d-none d-sm-block"></i>
                  </div>
                  <span style="margin-top: -20px; margin-left:90px" id="pos"></span>
                </a>
                <div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list" aria-labelledby="profileDropdown">   
                  <div class="dropdown-divider"></div>
                  <a href="index.html" class="dropdown-item preview-item">
                    <div class="preview-thumbnail">
                      <div class="preview-icon bg-dark rounded-circle">
                        <i class="mdi mdi-logout text-danger"></i>
                      </div>
                    </div>
                    <div class="preview-item-content" >
                      <p class="preview-subject mb-1" >Log out</p>
                    </div>
                  </a>
                  <div class="dropdown-divider"></div>
                  
                </div>
              </li>
            </ul>
            <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
              <span class="mdi mdi-format-line-spacing"></span>
            </button>
          </div>
        </nav>

        <!-- partial:partials/_navbar.html -->
        
        <!-- partial -->
       <div class="main-panel">
          <div class="content-wrapper">
            <div class="page-header">
              <h3 class="page-title">MAPPING AND TAGGING</h3>
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="#"></a></li>
                  
                </ol>
              </nav>
            </div>
            <div class="row">
              

              
              <div class="col-12 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body" id="container" >
                    
                 
                     <img src="mapa.png" width="100%" height="50%" id = "map"/>
                     <br>
                     <br>
                      <p class="card-description"> Input Details </p>
                    <form class="form-sample">                     
                      <div class="row">
                        <div class="col-md-6">
                          <div class="form-group row">
                            <label class="col-sm-3 col-form-label">FSIC No.:</label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" id="fscec"  />
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-group row">
                            <label class="col-sm-3 col-form-label" >Establishment Name:</label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" id="estabname" readonly />
                            </div>
                          </div>
                        </div>
                      </div> 

                      <div class="row">
                        <div class="col-md-6">
                          <div class="form-group row">
                            <label class="col-sm-3 col-form-label" >Owner's Name:</label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" id="owner" readonly />
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-group row">
                            <label class="col-sm-3 col-form-label" >Status</label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" id="stat" readonly />
                            </div>
                          </div>
                        </div>
                      </div> 

                        <div class="row">
                        <div class="col-md-6">
                          <div class="form-group row">
                            <label class="col-sm-3 col-form-label" >Map Location X:</label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" id="mapx" readonly />
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-group row">
                            <label class="col-sm-3 col-form-label" >Map Location Y:</label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" id="mapy" readonly />
                            </div>
                          </div>
                        </div>
                      </div> 

                    </form>
                    <br>
                    <div >
                      
                   
                     <button  class="btn btn-primary mr-2" id = "refresh" >Refresh</button>                
                     <button  class="btn btn-primary mr-2" id = "save" >Submit</button>
                         </div>  
                  </div>
                </div>
              </div>
              


              
            
          <!-- partial -->
        </div>

        
              
            
          <!-- partial -->
       
            
          <!-- partial -->
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="assets/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="assets/vendors/chart.js/Chart.min.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="assets/js/off-canvas.js"></script>
    <script src="assets/js/hoverable-collapse.js"></script>
    <script src="assets/js/misc.js"></script>
    <script src="assets/js/settings.js"></script>
    <script src="assets/js/todolist.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="assets/js/chart.js"></script>
    <!-- End custom js for this page -->
  <<script src="bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
<!-- Slimscroll -->
<script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<!-- fullCalendar -->
<script src="bower_components/moment/moment.js"></script>
<script src="bower_components/fullcalendar/dist/fullcalendar.min.js"></script>
    <!-- End custom js for this page -->

<script>
$(function () {

  
  function getfac(){

                
      let x = decodeURIComponent(document.cookie);

                      if(x == "as"){


                        window.location="index.html"
                      }


                      else{

                         
                          
                        

                        getcurrentuser(x);
                       //  getpic(x);

                      }

                  }




                        function getcurrentuser(a){
              

                                        $.ajax({
                                          type: "POST",
                                          url: "php/retrievecurrentuser.php",
                                          dataType: "json",
                                            data: {
                                              a:a, 
                                             
                                             
                                         
                                            },
                                          success: function(result){
                                            var _res = result;
                                            if(_res.status == 1){

                                          
                                           
                                             $("#name1").text(_res.a1 + " " + _res.a2 + " " + _res.a3);
                                             $("#pos").text(_res.a6);
                                             
                                           




                                             
                                            } 
                                          }
                                        });}







$(window).on("load", getfac());


    $("#fscec").on("input", function(){
            var a = $("#fscec").val();
    

            getuser(a);

          });

                        function getuser(a){

                          
                          

                                        $.ajax({
                                          type: "POST",
                                          url: "php/retrievemapid.php",
                                          dataType: "json",
                                            data: {

                                              a:a, 
                                             
                                                                                     
                                            },
                                          success: function(result){
                                            var _res = result;
                                            if(_res.status == 1){

                                          
                                             $("#estabname").val(_res.a1);
                                             $("#owner").val(_res.a2);
                                             $("#stat").val(_res.a3);
                                                                                                                                                   
                                            } 

                                            else{

                                              $("#estabname").val("");
                                             $("#owner").val("");
                                             $("#stat").val("");

                                            }
                                          }
                                        });}



var savebutton= document.getElementById("save");
    savebutton.disabled = true;




    const container = document.getElementById('container');
  const image = document.getElementById('map');




             $("#refresh").click(function(){

                     window.location="formmap.html"

                            
                          });               
                  




  

                map.addEventListener('click', () => {
                  
                           a= $("#fscec").val();
                           b= $("#estabname").val();
                           c= $("#owner").val();

                           d= $("#stat").val();
                           e= $("#mapx").val();
                           f= $("#mapy").val();
                          


                          const containerRect = container.getBoundingClientRect();
                          const imageRect = image.getBoundingClientRect();
                          const x = event.offsetX + (imageRect.left - containerRect.left);
                          const y = event.offsetY + (imageRect.top - containerRect.top);

                        


                               if (a.length > 0 && b.length > 0 && c.length > 0 && d.length >  0){
                                      $("#mapx").val(x);
                                      $("#mapy").val(y);

                                    addSpan(x,y,a) ;
                                      savebutton.disabled = false;

                            }

                            else{
                              alert("Please complete all needed data!");
                            }

              });







                  function addSpan(x,y,a) {
    
                      var img = document.getElementById("map");

                          var span = document.createElement("span");

                        var spanText = document.createTextNode(a);
                        span.appendChild(spanText);
                        span.style.color = "red";


                        var x = x;
                        var y = y;
                        span.style.position = "absolute";
                        span.style.top = y + "px";
                        span.style.left = x + "px";


                        img.parentNode.insertBefore(span, img.nextSibling);
                }


                        save.addEventListener('click', () => {
                  
                           a= $("#fscec").val();
                           b= $("#estabname").val();
                           c= $("#owner").val();

                           d= $("#stat").val();
                           e= $("#mapx").val();
                           f= $("#mapy").val();


                        

                        


                               if (a.length > 0 && b.length > 0 && c.length > 0 && d.length >  0){
                                        savegrave(a,b,c,d,e,f);

                            }

                            else{
                              alert("Please complete all needed data!");
                            }

              });





            function   savegrave(a,b,c,d,e,f){

                  $.ajax({
                  type: "POST",
                  url: "php/savemapdata.php",
                  dataType: "json",
                  data: {
                      a:a,
                      b:b,
                      c:c,
                      d:d,
                      e:e,
                      f:f,
                     
                    
                            
            
                            },
                        
                            success: function(result) {
                            var _res = result;
                              if (_res.status == 1){

                                  alert("Successfully added!")
                                  window.location = "formmap.html";

                           
                              } else if(_res.status == 2){
                                    alert("Successfully added!");
                                  
                                   
                          
                           
                              }
                              
                            }
                          
                             

                          });
                        }




  function getgravemax(){
  
                  var type = "bfpmap";

                          $.ajax({
                            type: "POST",
                            url: "php/getmaxmap.php",
                            dataType: "json",
                              data: {
                                type,
                               
                               
                           
                              },
                            success: function(result){
                              var _res = result;
                              if(_res.status == 1){
                             

                              
                                retrievemap(_res.unid);
                               
                              } 
                            }
                          });}



        function retrievemap(a){

          var b;

          for(b=0;a>b;a--){
              getgravemap(a);


          }

        }




               function getgravemap(a){

                            $.ajax({
                            type: "POST",
                            url: "php/getestabnameid.php",
                            dataType: "json",
                              data: {
                               
                               a:a,
                              
                           
                              },
                            success: function(result){
                              var _res = result;
                              if(_res.status == 1){
                              


                                addSpan2(_res.a1,_res.a2,_res.a3);

                                                           
                              } 

                              else{
                               

                                
                              }



                            }
                          });}




        function addSpan2(x,y,a) {


    alert("sss");
                      var img = document.getElementById("map");

                          var span = document.createElement("span");

                        var spanText = document.createTextNode(a);
                        span.appendChild(spanText);
                        span.style.color = "yellow";


                        var x = x;
                        var y = y;
                        span.style.position = "absolute";
                        span.style.top = y + "px";
                        span.style.left = x + "px";


                        img.parentNode.insertBefore(span, img.nextSibling);
                }



              function checkifloggedin(){

                      let x = decodeURIComponent(document.cookie);

                        
                      if(x == ""){


                        window.location="index.html"
                      }


                      else{

                        

                        getcurrentuser(x);

                      }

                  }


                       










       $(window).on("load",checkifloggedin());      

 $(window).on("load", getgravemax()); 

   })

</script>

</body>

</html>